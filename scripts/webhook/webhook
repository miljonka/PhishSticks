#!/bin/python3
from flask import Flask, request
import os

app = Flask(__name__)

def get_next_log_number():
    log_number = 1
    while os.path.exists(f'log-{log_number}.txt'):
        log_number += 1
    return log_number

@app.route('/server', methods=['POST'])
def handle_webhook():
    if request.method == 'POST':
        data = request.data
        log_number = get_next_log_number()
        log_filename = f'log-{log_number}.txt'

        with open(log_filename, 'w') as file:
            file.write(data.decode("utf-8"))

        return f"Webhook data received and logged as {log_filename}", 200
    else:
        return "Unsupported method", 501

if __name__ == '__main__':
    app.run(host='192.168.66.2', port=80)
